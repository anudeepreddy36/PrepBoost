package controllers

import (
    "fmt"
    "net/http"
    "net/http/httptest"
    "testing"

    models "prepboost.com/web/models"
)

func checkResponseCode(t *testing.T, expected, actual int) {
    if expected != actual {
        t.Errorf("Expected response code %d. Got %d\n", expected, actual)
    }
}

//Test-1
//To get the Questions year wise from the database
func TestQuestionsYearwise(t *testing.T) {
    models.Init()

    req, err := http.NewRequest("GET", "/questions/2020", nil)
    req.Header.Set("Content_Type", "application/json")
    if err != nil {
        t.Fatal(err)
    }

    handler := http.HandlerFunc(GetYearwiseQuestions)
    rr := httptest.NewRecorder()

    handler.ServeHTTP(rr, req)
    checkResponseCode(t, http.StatusOK, rr.Code)

    if status := rr.Code; status != http.StatusOK {
        t.Errorf("handler returned wrong status code : got %v want %v\n", status, http.StatusOK)
    }

    expectOutput := `[{"ID":1,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"In India, Legal Services Authorities provide free legal services to which of the following type of citizens?\\n\\n1. Person with an annual income of less than Rs. 1,00,000\\n\\n2. Transgender with an annual income of less than Rs. 2,00,000\\n\\n3. Member of Other Backward Classes (OBC) with an annual income of less than Rs. 3,00,000\\n\\n4. All Senior Citizens\\n\\nSelect the correct answer using the code given below:","Answer":"A","Option1":"1 and 2 only","Option2":"3 and 4 only","Option3":"2 and 3 only","Option4":"1 and 4 only","Explanation":"No one will study the numbers this deep. This question is to be answered by elimination and common sense. \\n\\nWe can eliminate statement 4 as the word 'All' is included which is not possible as there can be super rich senior citizens like Ratan Tata etc. Then we are left with  option 1 \u0026 option 3. \\n\\nNow, both the remaining options have statement 2, so it must be right. We just need to eliminate statement 1 or statement 3. \\n\\nIn statement 1 the annual income is given as Rs. 1 lakh and the other statement has 3 lakhs. So logically speaking, we will go with the lower income statement and choose option A (1 \u0026 2 only)","Learning":"UPSC expects us to use common sense \u0026 solve the questions rather than complete bookish knowledge. So keep your cool in the exam","Source":""},{"ID":2,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"Consider the following statements:\\n\\n1. According to the Constitution of India, a person who is eligible to vote can be made a minister in a state for six months even if he/she is not a member of that state.\\n\\n2. According to the Representation of People Act, 1951, a person convicted of a criminal offence and sentenced to imprisonment for five years is permanently disqualified from contesting an election even after his release from prison.\\n\\nWhich of the statements given above is/are correct?","Answer":"D","Option1":"1 only","Option2":"2 only","Option3":"Both 1 and 2","Option4":"Neither 1 nor 2","Explanation":"This question was probably asked in the context of the Maharashtra crisis that happened during October 2019. If you don't know about it, read it on wiki here : https://en.wikipedia.org/wiki/2019_Maharashtra_political_crisis \\n\\nAt first glance the 1st statement might look true. But there is a catch, the age for voting is 18 years \u0026 the age to become eligible for a minister is 25 years in both State Legislature \u0026 Lok Sabha. Hence statement one is wrong. \\n\\nStatement 2 is wrong because there is no permanent disqualification of a person in any case of conviction. It is a long standing demand from many sections that persons who committed serious crimes must be permanently disqualified which is not yet in force. \\n\\nThe statement given in RPA, 1951 is 'A person convicted of any offense and sentenced to imprisonment for not less than 2 years shall be disqualified from the date of such conviction and shall continue to be disqualified for a further period of six years since his release'. So it's not permanent. Hence option D must be correct","Learning":"We must read the question very carefully to eliminate statement 1 \u0026 avoid silly mistakes","Source":""},{"ID":3,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"With reference to the history of India, consider the following pairs:\\nFamous Place : Present State\\n\\n1. Bhilsa --- Madhya Pradesh\\n\\n2. Dwarasamudra --- Maharashtra\\n\\n3. Girinagar --- Gujarat\\n\\n4. Sthaneshwara --- Uttar Pradesh\\n\\nWhich of the pairs given above are correctly matched?","Answer":"A","Option1":"1 and 3 only","Option2":"1 and 4 only","Option3":"2 and 3 only","Option4":"2 and 4 only","Explanation":"There was a question on Asiatic lion in 2019 prelims which are only present in Gir National Park in Gujarat. So even if you don't know any of these given places you must know statement 3 is correct if you have solved previous years questions. By this we can eliminate options B \u0026 D. It's 50-50 now, we must choose b/w statement 1 and 2. \\n\\nNow, if we don't know any of the remaining two places, let's see how to answer this. If you are from MP, GJ, RJ, MH etc (the central Indian states) or any of you who heard about the Bhil tribe could have guessed statement 1 might be correct and gone for option 1 which is the correct answer. \\n\\nThe reason is Bhil tribe is one of the largest tribes in India. They are also demanding a separate Bhil state called Bhil Pradesh which was also in news. They are mostly concentrated in the central Indian states. \\n\\nLet's see what actually is Bhilsa. It's a place in MP where there are Buddhist \u0026 Jain architectures. Further, Dwarasamudra is located in Karnataka \u0026 was the capital of the Hoysala rulers. \\n\\nSthaneshwara is in Harayana. It was the main seat of the Pushyabhuti dynasty. Famous king Harshavardhana (606-647CE) was from this dynasty. The capital of this dynasty was Sthaneshwara initially which was later on shifted to Kannauj. So option 1 is the correct answer.","Learning":"Solving previous years questions multiple times with in depth analysis is needed. You never know in what way they become useful.","Source":""},{"ID":4,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"In the context of recent advances in human reproductive technology, ‘Pronuclear Transfer” is used for","Answer":"D","Option1":"Fertilization of egg in vitro by the donor sperm","Option2":"Genetic modification of sperm producing cells","Option3":"Development of stem cells into functional embryos","Option4":"Prevention of mitochondrial diseases in offspring","Explanation":"Pronuclear transfer technique is used to prevent faulty mitochondria from being passed from a mother to her child. The 3-parent baby which you might have heard of is a result of this. The vast majority of this baby's DNA will come from the mother and father. A small bit of extra DNA will come from another woman (DNA from mitochondria). So option D is correct here. \\n\\nRead more at https://www.sciencenewsforstudents.org/article/how-make-three-parent-baby","Learning":"The 3 parent baby is often seen in the news but some of you might have missed the term pronuclear transfer there. So cover biotech carefully, given more importance in Prelims nowadays.","Source":""},{"ID":5,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"Consider the following statements\\n\\n1. The weightage of food in Consumer Price Index (CPI) is higher than that in Wholesale Price Index (WPI).\\n\\n2. The WPI does not capture changes in the prices of services, which CPI does.\\n\\n3. Reserve Bank of India has now adopted WPI as its key measure of inflation and to decide on changing the key policy rates.\\n\\nWhich of the statements given above is/are correct ?","Answer":"A","Option1":"1 and 2 only","Option2":"2 only","Option3":"3 only","Option4":"1, 2 and 3","Explanation":"The question can be easily answered if you know in statement 3 RBI has adopted CPI instead of WPI. Here it is given as the opposite. Statement 1 is correct as CPI has more weightage of food than WPI. So option A is correct.","Learning":"WPI \u0026 CPI are asked multiple times by UPSC you must know all the details about them.","Source":""},{"ID":6,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"One common agreement between Gandhism and Marxism is","Answer":"A","Option1":"The final goal of a stateless society","Option2":"Class struggle","Option3":"Abolition of private property","Option4":"Economic determinism","Explanation":"Brace yourself, this explanation is long. \\n\\nAll of us know, Gandhiji is about non-violence, so do you think he talks about class struggle? No. So we eliminate option B first. \\n\\nComing to option C, Gandhiji never wanted to abolish private property even though the demands of expropriation were raised from several quarters. He was firm of the opinion that the rich and the powerful should 'voluntarily surrender' their wealth for the welfare of people as a matter of their duty. Payment should be made on the basis of the people's needs and not on the basis of their share in the production processes. This could result in the promotion of the idea of shared societal life. \\n\\nBut, Marx gave a different view. He said that bourgeoisie private property exploits the working class. Their property should be abolished and be converted to common property used by all members of society. So both of them have different opinions. Hence eliminate option C  \\n\\nNow, coming to option D.  Economic determinism is a theory which states that economic relationships (such as being an owner or capitalist, or being a worker or proletarian) are the foundation upon which all other societal and political arrangements in society are based. This is associated with Karl Marx and Gandhi never talks about it. So we eliminate option D and left with option A which is the answer. \\n\\nNow, let's see about option A. Gandhiji always felt that the government is the best which governs the least. Both Gandhiji and Marx wanted to dismantle the state because it was soulless (as Gandhiji said) or dehumanizing (as Marx put it). Gandhiji talks of Rama Rajya a social order free from political bindings and consisting of self governing individuals. While Marx spoke of stateless communist society of the future. \\n\\nThe explanation is very simplified here. Please read more about both of them yourself here : https://www.mkgandhi.org/articles/articleindex.htm","Learning":"Gandhiji is one of UPSCs favourite topics both for Prelims \u0026 Mains. Please learn all about him. Solve all the questions by typing Gandhi in the Search in the app. \\n\\nIf you had prepared for Mains you would know this. So indeed preparing for Mains helps in Prelims \u0026 vice versa.","Source":""},{"ID":7,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"Which of the following are the reasons/factors for exposure to benzene pollution ?\\n\\n1. Automobile exhaust\\n\\n2. Tobacco smoke\\n\\n3. Wood burning\\n\\n4. Using varnished wooden furniture\\n\\n5. Using products made of polyurethane\\n\\nSelect the correct answer using the code given below :","Answer":"D","Option1":"1, 2 and 3 only","Option2":"2 and 4 only","Option3":"1, 3 and 4 only","Option4":"1, 2, 3, 4 and 5","Explanation":"UPSC doesn't expect you to know each \u0026 every chemical released from every source. So I would go with All correct in such cases unless I specifically know it's not correct. So Option D","Learning":"UPSC pattern questions can be understood by solving the previous year questions repeatedly.","Source":""},{"ID":8,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"What are the advantages of fertigation in agriculture?\\n\\n1. Controlling the alkalinity of irrigation water is possible.\\n\\n2. Efficient application of Rock Phosphate and all other phosphatic fertilizers is possible.\\n\\n3. Increased availability of nutrients to plants is possible.\\n\\n4. Reduction in the leaching of chemical nutrients is possible.\\n\\nSelect the correct answer using the code given below:","Answer":"C","Option1":"1, 2 and 3 only","Option2":"1, 2 and 4 only","Option3":"1, 3 and 4 only","Option4":"2, 3 and 4 only","Explanation":"Fertigation is a combination of Fertilizer + Irrigation. It means delivering (water soluble) fertilizers through the water in Drip irrigation. So, the basic purpose of this is explained in statements 3 \u0026 4 where it increases nutrients supply as the fertilizer directly goes to the plant and there will be less leaching. Hence we now have options C \u0026 D to choose from. \\n\\nAlkalinity of water is the ability of the water body to neutralize acids and bases and thus maintain a fairly stable pH level. So in fertigation, we can do that to irrigation water as the amount of fertilizer applied depends on us. So option C must be correct. \\n\\nFurther, even if you are confused b/w statement 1 \u0026 2, in statement 2 it is mentioned that efficient application to 'ALL' phosphatic fertilizers is possible which may be eliminated as it includes ALL which looks kind of extreme. ","Learning":"Agriculture is an important topic in both Prelims and Mains. Hence focusing on it can bring dividends","Source":""},{"ID":9,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"With reference to the scholars/litterateurs of ancient India, consider the following statements:\\n\\n1. Panini is associated with Pushyamitra Shunga\\n\\n2. Amarasimha is associated with Harshavardhana\\n\\n3. Kalidasa is associated with Chandra Gupta-II\\n\\nWhich of the statements given above is/are correct?","Answer":"C","Option1":"1 and 2 only","Option2":"2 and 3 only","Option3":"3 only","Option4":"1,2 and 3","Explanation":"Kalidasa must be known to everyone because it's been repeated in many exams by UPSC. He was one of the famous Navaratna scholars in the court of Chandragupta-II. So statement 3 is correct. We can eliminate option A \\n\\nPanini was asked in CAPF 2013 exam. He was a Sanskrit grammarian who wrote Ashtadhyayi and belonged to the 5-6th century whereas Sunga dynasty existed after Mauryans in the 2nd century BCE. So by eliminating statement 1 we still can't answer the question as options B \u0026 C are left. \\n\\nAmarasimha was asked in CAPF 2015 exam. So similar case as above, a repeated question. He was friends with Kalidasa, one among the Navaratnas in the court of Chandragupta-II. So statement 2 is wrong. So we arrive at option C","Learning":"Read more about Navaratnas and the books they authored. Similar questions are repeated frequently.","Source":""},{"ID":10,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"Consider the following statements\\n\\n1. In the case of all cereals, pulses and oil-seeds, the procurement at Minimum Support Price (MSP) is unlimited in any State/UT of India.\\n\\n2. In the case of cereals and pulses, the MSP is fixed in any State/UT at a level to which the market price will never rise.\\n\\nWhich of the statements given above is/are correct?","Answer":"D","Option1":"1 only","Option2":"2 only","Option3":"Both 1 and 2","Option4":"Neither 1 nor 2","Explanation":"If you read about MSP, you might be knowing it is not unlimited in all the states, in fact not even procured in some states. So statement 1 is wrong. Even if you didn't know this, it looks like an extreme statement considering North East \u0026 UTs etc where the system isn't robust. \\n\\nFor statement 2, by simple logic you can say no one can predict the Market prices as they are market determined. A kg of onions can cost Rs. 2 today \u0026 tomorrow they can be Rs. 200/- how can somebody fix a kg of onions MSP more than Rs. 200? Further market prices vary from state to state. \\n\\nSo MSP is fixed by considering the cost of cultivation and production, the productivity of crops, and market prices to be remunerative for farmers by CACP (Commission for Agricultural Costs \u0026 Prices)","Learning":"MSP is one of UPSCs favourite topics frequently asked in both Mains and Prelims. You must know everything about it. In the 2020 Prelims itself, there are 2 questions on MSP","Source":""}]`

    if rr.Body.String() != expectOutput {
        t.Errorf("handler returned unexpected body : got %v want %v", rr.Body.String(), expectOutput)
        fmt.Println(len(rr.Body.String()), "------", len(expectOutput))
    }

}

//Test-2
//To get the Questions topic wise from the database
func TestQuestionsTopicwise(t *testing.T) {
    models.Init()

    req, err := http.NewRequest("GET", "/topicwise/1/1", nil)
    req.Header.Set("Content_Type", "application/json")
    if err != nil {
        t.Fatal(err)
    }

    handler := http.HandlerFunc(GetTopicwiseQuestions)
    rr := httptest.NewRecorder()

    handler.ServeHTTP(rr, req)
    checkResponseCode(t, http.StatusOK, rr.Code)

    if status := rr.Code; status != http.StatusOK {
        t.Errorf("handler returned wrong status code : got %v want %v\n", status, http.StatusOK)
    }

    expectedOutput := `[{"ID":221,"Exam":"IAS","Type":"Prelims","Year":2018,"Question":"Increase in absolute and per capita real GNP do not connote a higher level of economic development, if","Answer":"C","Answered":"","Option1":"Industrial output fails to keep pace with agricultural output.","Option2":"Agricultural output fails to keep pace with industrial output.","Option3":"Poverty and unemployment increase.","Option4":"Imports grow faster than exports.","Explanation":"","Learning":"","Source":""},{"ID":531,"Exam":"IAS","Type":"Prelims","Year":2015,"Question":"With reference to India economy, consider the following statements:\\n\\n1. The rate of growth of real Gross Domestic Product has steadily increased in the last decade.\\n\\n2. The Gross Domestic Product at market prices (in rupees) has steadily increased in the last decade\\n\\nWhich of the statement given above is/are correct?","Answer":"B","Answered":"","Option1":"1 only","Option2":"2 only","Option3":"Both 1 and 2","Option4":"Neither 1 nor 2","Explanation":"","Learning":"","Source":""},{"ID":767,"Exam":"IAS","Type":"Prelims","Year":2013,"Question":"Economic growth in country X will necessarily have to occur if","Answer":"C","Answered":"","Option1":"There is technical progress in the world economy","Option2":"There is population growth in X","Option3":"There is capital formation in X","Option4":"The volume of trade grows in the world economy","Explanation":"","Learning":"","Source":""},{"ID":774,"Exam":"IAS","Type":"Prelims","Year":2013,"Question":"The national income of a country for a given period is equal to the","Answer":"D","Answered":"","Option1":"Total value of goods and services produced by the nationals","Option2":"Sum of total consumption and investment expenditure","Option3":"Sum of personal income of all individuals","Option4":"Money value of final goods and services produced.","Explanation":"","Learning":"","Source":""},{"ID":982,"Exam":"IAS","Type":"Prelims","Year":2011,"Question":"In the context of Indian economy, consider the following statements :\\n\\n1. The growth rate of GDP has steadily increased in the last five years.\\n\\n2. The growth rate in per capita income has steadily increased in the last five years.\\n\\nWhich of the statements given above is/ are correct?","Answer":"D","Answered":"","Option1":"1 only","Option2":"2 only","Option3":"Both 1 and 2","Option4":"Neither 1 nor 2","Explanation":"","Learning":"","Source":""}]`

    if rr.Body.String() != expectedOutput {
        t.Errorf("handler returned unexpected body : got %v want %v", rr.Body.String(), expectedOutput)
        fmt.Println(len(rr.Body.String()), "------", len(expectedOutput))
    }

}

//Test-3
//To get the Bookmarked questions from the database
func TestGetBookmarkedQuestions(t *testing.T) {
    models.Init()

    req, err := http.NewRequest("GET", "/bookmarks/14", nil)
    req.Header.Set("Content_Type", "application/json")
    if err != nil {
        t.Fatal(err)
    }

    handler := http.HandlerFunc(GetBookmarkedQuestions)
    rr := httptest.NewRecorder()

    handler.ServeHTTP(rr, req)
    checkResponseCode(t, http.StatusOK, rr.Code)

    if status := rr.Code; status != http.StatusOK {
        t.Errorf("handler returned wrong status code : got %v want %v\n", status, http.StatusOK)
    }

    expectedOutput := `[{"ID":1,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"In India, Legal Services Authorities provide free legal services to which of the following type of citizens?\\n\\n1. Person with an annual income of less than Rs. 1,00,000\\n\\n2. Transgender with an annual income of less than Rs. 2,00,000\\n\\n3. Member of Other Backward Classes (OBC) with an annual income of less than Rs. 3,00,000\\n\\n4. All Senior Citizens\\n\\nSelect the correct answer using the code given below:","Answer":"A","Option1":"1 and 2 only","Option2":"3 and 4 only","Option3":"2 and 3 only","Option4":"1 and 4 only","Explanation":"No one will study the numbers this deep. This question is to be answered by elimination and common sense. \\n\\nWe can eliminate statement 4 as the word 'All' is included which is not possible as there can be super rich senior citizens like Ratan Tata etc. Then we are left with  option 1 \u0026 option 3. \\n\\nNow, both the remaining options have statement 2, so it must be right. We just need to eliminate statement 1 or statement 3. \\n\\nIn statement 1 the annual income is given as Rs. 1 lakh and the other statement has 3 lakhs. So logically speaking, we will go with the lower income statement and choose option A (1 \u0026 2 only)","Learning":"UPSC expects us to use common sense \u0026 solve the questions rather than complete bookish knowledge. So keep your cool in the exam","Source":""},{"ID":2,"Exam":"IAS","Type":"Prelims","Year":2020,"Question":"Consider the following statements:\\n\\n1. According to the Constitution of India, a person who is eligible to vote can be made a minister in a state for six months even if he/she is not a member of that state.\\n\\n2. According to the Representation of People Act, 1951, a person convicted of a criminal offence and sentenced to imprisonment for five years is permanently disqualified from contesting an election even after his release from prison.\\n\\nWhich of the statements given above is/are correct?","Answer":"D","Option1":"1 only","Option2":"2 only","Option3":"Both 1 and 2","Option4":"Neither 1 nor 2","Explanation":"This question was probably asked in the context of the Maharashtra crisis that happened during October 2019. If you don't know about it, read it on wiki here : https://en.wikipedia.org/wiki/2019_Maharashtra_political_crisis \\n\\nAt first glance the 1st statement might look true. But there is a catch, the age for voting is 18 years \u0026 the age to become eligible for a minister is 25 years in both State Legislature \u0026 Lok Sabha. Hence statement one is wrong. \\n\\nStatement 2 is wrong because there is no permanent disqualification of a person in any case of conviction. It is a long standing demand from many sections that persons who committed serious crimes must be permanently disqualified which is not yet in force. \\n\\nThe statement given in RPA, 1951 is 'A person convicted of any offense and sentenced to imprisonment for not less than 2 years shall be disqualified from the date of such conviction and shall continue to be disqualified for a further period of six years since his release'. So it's not permanent. Hence option D must be correct","Learning":"We must read the question very carefully to eliminate statement 1 \u0026 avoid silly mistakes","Source":""}]`

    if rr.Body.String() != expectedOutput {
        t.Errorf("handler returned unexpected body : got %v want %v", rr.Body.String(), expectedOutput)
        fmt.Println(len(rr.Body.String()), "------", len(expectedOutput))
    }
}

